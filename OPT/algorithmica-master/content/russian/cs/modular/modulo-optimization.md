---
title: Оптимизация операций по модулю
authors:
- Иван Сафонов
weight: 100
draft: true
---

Давайте разберемся, как считать значения выражения по модулю так, чтобы
это требовало минимального количества процессорных операций.

Если мы складываем значения, каждое из которых меньше $MOD$, то можно не
брать их по модулю, а обходиться $if$-ами и вычитанием:

``` c++ numberLines
int res = a + b;
if (res >= MOD) {
    res -= MOD;
}
```

В некоторых задачах, где надо считать сумму произведений величин, каждая
из которых меньше $MOD$, бывает полезна следующая
<i>неасимптотическая</i> оптимизация: Будем считать все
произведения по модулю $MOD^2$, для подсчета сумм таких величин
воспользуемся предыдущей техникой, а затем единожды возьмем
ответ по модулю $MOD$. Такой трюк бывает полезен, к примеру, при
[перемножении матриц](Возведение_матрицы_в_степень "wikilink"):

``` c++ numberLines
matrix multiple(matrix& a, matrix &b) {
    int n = a.size();
    int m = b[0].size();
    int k = b.size();
    matrix c(n, m);
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < m; j++) {
            int res = 0;
            for (int t = 0; t < k; t++) {
                res += a[i][t] * b[t][j];
                if (res >= MOD2) {
                   res -= MOD2;
                }
            }
            c[i][j] = res % MOD;
        }
    }
    return res;
}
```
